This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
App.tsx
components/Layout.tsx
components/ui/PixelComponents.tsx
components/ui/PixelDatePicker.tsx
index.css
index.html
index.tsx
metadata.json
package.json
pages/Achievements.tsx
pages/CharacterCreation.tsx
pages/Dashboard.tsx
pages/GameHub.tsx
pages/NotFound.tsx
pages/Shop.tsx
postcss.config.js
README.md
store.ts
tailwind.config.js
tsconfig.json
types.ts
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="App.tsx">
import React, { useState } from 'react';
import { HashRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { useStore } from './store';
import { Layout } from './components/Layout';
import { CharacterCreation } from './pages/CharacterCreation';
import { Dashboard } from './pages/Dashboard';
import { GameHub } from './pages/GameHub';
import { Shop } from './pages/Shop';
import { Achievements } from './pages/Achievements';
import { NotFound } from './pages/NotFound';

const App: React.FC = () => {
  const user = useStore(state => state.user);
  const [isEditorOpen, setEditorOpen] = useState(false);

  return (
    <Router>
      <div className="font-pixel antialiased text-gray-900 dark:text-gray-100 min-h-screen">
        <Routes>
          {/* Public Route: Character Creation */}
          <Route 
            path="/login" 
            element={!user ? <CharacterCreation /> : <Navigate to="/" replace />} 
          />

          {/* Protected Routes */}
          <Route
            path="/*"
            element={
              user ? (
                <Layout onAddTask={() => setEditorOpen(true)}>
                  <Routes>
                    <Route path="/" element={<Dashboard isEditorOpen={isEditorOpen} onCloseEditor={() => setEditorOpen(false)} />} />
                    <Route path="/gamehub" element={<GameHub />} />
                    <Route path="/shop" element={<Shop />} />
                    <Route path="/achievements" element={<Achievements />} />
                    <Route path="*" element={<NotFound />} />
                  </Routes>
                </Layout>
              ) : (
                <Navigate to="/login" replace />
              )
            }
          />
        </Routes>
      </div>
    </Router>
  );
};

export default App;
</file>

<file path="components/Layout.tsx">
import React, { useState } from 'react';
import { NavLink, useLocation } from 'react-router-dom';
import { useStore } from '../store';
import { CheckSquare, Gamepad2, ShoppingBag, Trophy, Menu, Plus, Settings, Sun, Moon, LogOut } from 'lucide-react';

interface LayoutProps {
  children: React.ReactNode;
  onAddTask: () => void;
}

export const Layout: React.FC<LayoutProps> = ({ children, onAddTask }) => {
  const { user, isDarkMode, toggleDarkMode, logout } = useStore();
  const location = useLocation();
  const [isSidebarOpen, setSidebarOpen] = useState(false);

  // Don't show layout on Login
  if (!user) return <>{children}</>;

  // Don't show layout on immersive game mode
  if (location.pathname.includes('/game-play')) return <>{children}</>;

  return (
    <div className="min-h-screen bg-background-light dark:bg-background-dark relative overflow-x-hidden transition-colors duration-200">
      
      {/* 1. Companion Trigger (Menu Button) - Top Left */}
      <div 
        onClick={() => setSidebarOpen(true)}
        className="fixed top-6 left-6 z-50 cursor-pointer group"
      >
        {/* Speech Bubble Tooltip */}
        <div className="absolute -top-10 left-8 opacity-0 group-hover:opacity-100 transition-all duration-200 transform scale-75 group-hover:scale-100 origin-bottom-left pointer-events-none">
            <div className="bg-white border-2 border-black px-3 py-1 whitespace-nowrap shadow-[2px_2px_0_0_#000]">
                <span className="text-lg font-bold uppercase text-black">Open Menu!</span>
                {/* Tail */}
                <div className="absolute -bottom-2 left-2 w-3 h-3 bg-white border-r-2 border-b-2 border-black transform rotate-45"></div>
            </div>
        </div>

        <div className="relative">
            {/* Avatar Circle */}
            <div className="w-16 h-16 bg-white dark:bg-card-dark rounded-full border-3 border-black dark:border-white flex items-center justify-center shadow-[4px_4px_0_0_#000] dark:shadow-[4px_4px_0_0_rgba(255,255,255,0.5)] transition-transform group-hover:-translate-y-1">
                <span className="text-4xl filter drop-shadow-sm select-none">
                    {user.companion === 'DOG' ? 'üê∂' : 'üê±'}
                </span>
            </div>
            {/* Menu Badge */}
            <div className="absolute -bottom-1 -right-1 bg-blue-500 text-white border-2 border-black p-1 rounded-full z-20">
                <Menu size={16} strokeWidth={3} />
            </div>
        </div>
      </div>

      {/* 2. XP Display - Top Right (Moved from Sidebar) */}
      <div className="fixed top-6 right-6 z-40">
        <div className="bg-yellow-50 dark:bg-yellow-900/30 border-3 border-black dark:border-white px-4 py-2 shadow-[4px_4px_0_0_#000] dark:shadow-[4px_4px_0_0_rgba(255,255,255,0.5)] flex items-center gap-3 transform hover:scale-105 transition-transform cursor-default">
            <span className="text-primary text-2xl animate-pulse">‚ö°</span>
            <div>
                <span className="font-bold text-2xl block leading-none">{user.xp} XP</span>
                <span className="text-xs uppercase font-bold text-gray-500 dark:text-gray-400">Level {user.level}</span>
            </div>
        </div>
      </div>

      {/* 3. Backdrop (Blur) */}
      <div 
        onClick={() => setSidebarOpen(false)}
        className={`
            fixed inset-0 z-40 bg-black/40 backdrop-blur-sm transition-opacity duration-300
            ${isSidebarOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}
        `}
      />

      {/* 4. Sidebar Drawer */}
      <aside 
        className={`
            fixed top-0 left-0 h-full w-80 bg-white dark:bg-card-dark border-r-4 border-black dark:border-white z-50 
            flex flex-col pt-28 px-6 pb-6 shadow-[10px_0_20px_rgba(0,0,0,0.2)]
            transform transition-transform duration-300 ease-out
            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}
        `}
      >
         {/* Drawer Header */}
         <div className="mb-8 border-b-2 border-black dark:border-white pb-4 border-dashed">
            <h2 className="text-4xl font-bold tracking-wider uppercase">Menu</h2>
            <p className="text-gray-500 dark:text-gray-400 text-xl">Where to next, Boss?</p>
         </div>

         {/* Navigation */}
         <nav className="flex-1 space-y-2">
            <DrawerItem to="/" icon={<CheckSquare size={24}/>} label="Dashboard" onClick={() => setSidebarOpen(false)} />
            <DrawerItem to="/gamehub" icon={<Gamepad2 size={24}/>} label="Game Hub" onClick={() => setSidebarOpen(false)} />
            <DrawerItem to="/shop" icon={<ShoppingBag size={24}/>} label="Item Shop" onClick={() => setSidebarOpen(false)} />
            <DrawerItem to="/achievements" icon={<Trophy size={24}/>} label="Hall of Fame" onClick={() => setSidebarOpen(false)} />
         </nav>

         {/* Bottom Actions */}
         <div className="mt-auto pt-6 border-t-2 border-black dark:border-white border-dashed space-y-4">
             {/* Dark Mode Toggle */}
            <button 
                onClick={toggleDarkMode}
                className="w-full flex items-center gap-4 text-2xl font-bold py-2 text-gray-600 dark:text-gray-300 hover:pl-6 transition-all duration-200"
            >
                {isDarkMode ? <Sun size={24} /> : <Moon size={24} />}
                <span>{isDarkMode ? 'Light Mode' : 'Dark Mode'}</span>
            </button>

            {/* Logout Button */}
            <button 
                onClick={() => {
                    setSidebarOpen(false);
                    logout();
                }}
                className="w-full bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 border-3 border-black dark:border-white py-3 text-xl font-bold text-red-600 dark:text-red-400 shadow-[4px_4px_0_0_#000] active:shadow-none active:translate-x-[4px] active:translate-y-[4px] transition-all flex items-center justify-center gap-2 uppercase"
            >
                <LogOut size={20} />
                Log Out
            </button>
         </div>
      </aside>

      {/* 5. Main Content */}
      <main className="pt-24 px-4 md:px-8 max-w-7xl mx-auto pb-24">
         {children}

         {/* Floating Add Task Button (Desktop & Mobile) */}
         {location.pathname === '/' && (
         <div className="fixed bottom-8 right-8 z-30">
            <button 
                onClick={onAddTask}
                className="w-16 h-16 bg-primary text-black border-3 border-black rounded-full flex items-center justify-center shadow-[4px_4px_0_0_#000] hover:-translate-y-1 hover:shadow-[6px_6px_0_0_#000] active:shadow-none active:translate-y-1 transition-all group"
            >
                <Plus size={32} strokeWidth={3} className="group-hover:rotate-90 transition-transform duration-300"/>
            </button>
        </div>
        )}
      </main>

    </div>
  );
};

const DrawerItem = ({ to, icon, label, onClick }: { to: string, icon: React.ReactNode, label: string, onClick: () => void }) => (
    <NavLink 
      to={to} 
      onClick={onClick}
      className={({ isActive }) => `
          flex items-center gap-4 text-2xl font-bold py-3 px-2 transition-all duration-200 group rounded
          ${isActive 
             ? 'bg-gray-100 dark:bg-gray-800 text-black dark:text-white pl-6 border-l-4 border-black dark:border-white' 
             : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:pl-6'
          }
      `}
    >
        <span className="group-hover:scale-110 transition-transform">{icon}</span>
        <span className="uppercase">{label}</span>
    </NavLink>
);
</file>

<file path="components/ui/PixelComponents.tsx">
import React from 'react';
import { motion } from 'framer-motion';

interface PixelCardProps {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
  noShadow?: boolean;
}

export const PixelCard: React.FC<PixelCardProps> = ({ children, className = '', onClick, noShadow }) => {
  return (
    <div 
      onClick={onClick}
      className={`
        bg-card-light dark:bg-card-dark 
        border-3 border-black dark:border-white 
        ${noShadow ? '' : 'shadow-pixel dark:shadow-[4px_4px_0px_0px_rgba(255,255,255,0.2)]'} 
        p-4 sm:p-6 relative transition-transform
        ${onClick ? 'active:translate-y-1 active:shadow-pixel-active cursor-pointer' : ''}
        ${className}
      `}
    >
      {children}
    </div>
  );
};

interface PixelButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger' | 'outline' | 'ghost';
  fullWidth?: boolean;
}

export const PixelButton: React.FC<PixelButtonProps> = ({ 
  children, 
  variant = 'primary', 
  fullWidth = false, 
  className = '',
  ...props 
}) => {
  const variants = {
    primary: 'bg-primary text-black hover:bg-yellow-400',
    secondary: 'bg-secondary text-black hover:bg-green-400',
    danger: 'bg-accent text-white hover:bg-red-500',
    outline: 'bg-transparent border-3 border-black dark:border-white text-black dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800',
    ghost: 'bg-transparent border-none shadow-none text-black dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800'
  };

  const shadowClass = variant === 'ghost' ? '' : 'shadow-pixel hover:shadow-pixel-sm active:shadow-pixel-active active:translate-x-[2px] active:translate-y-[2px]';
  const borderClass = variant === 'ghost' ? '' : 'border-3 border-black dark:border-white';

  return (
    <button
      className={`
        ${variants[variant]}
        ${borderClass}
        ${shadowClass}
        ${fullWidth ? 'w-full' : ''}
        py-3 px-6 text-xl font-bold uppercase tracking-wide
        transition-all duration-100
        flex items-center justify-center gap-2
        disabled:opacity-50 disabled:cursor-not-allowed
        ${className}
      `}
      {...props}
    >
      {children}
    </button>
  );
};

interface PixelModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

export const PixelModal: React.FC<PixelModalProps> = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
      {/* Dither Background Overlay */}
      <motion.div 
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        exit={{ opacity: 0 }}
        onClick={onClose}
        className="absolute inset-0 bg-black/40 backdrop-blur-sm bg-dither bg-[length:4px_4px]"
      />
      
      {/* Modal Content */}
      <motion.div
        initial={{ scale: 0.9, opacity: 0, y: 20 }}
        animate={{ scale: 1, opacity: 1, y: 0 }}
        exit={{ scale: 0.9, opacity: 0, y: 20 }}
        className="relative z-10 w-full max-w-lg bg-background-light dark:bg-card-dark border-3 border-black dark:border-white shadow-[8px_8px_0px_0px_#000] dark:shadow-[8px_8px_0px_0px_rgba(255,255,255,0.2)] flex flex-col max-h-[90vh]"
      >
        <div className="flex items-center justify-between p-4 border-b-3 border-black dark:border-white bg-black text-white">
            <h2 className="text-2xl uppercase tracking-widest">{title}</h2>
            <button onClick={onClose} className="hover:text-red-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="square" strokeLinejoin="miter"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div className="p-6 overflow-y-auto">
            {children}
        </div>
      </motion.div>
    </div>
  );
};

interface PixelInputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
}

export const PixelInput: React.FC<PixelInputProps> = ({ label, className = '', ...props }) => (
  <div className="space-y-2">
    {label && <label className="block text-xl uppercase font-bold text-gray-700 dark:text-gray-200">{label}</label>}
    <input 
      className={`
        w-full bg-white dark:bg-gray-800 
        border-3 border-black dark:border-gray-500
        p-3 text-xl outline-none
        focus:shadow-pixel-sm focus:border-primary dark:focus:border-primary
        transition-all placeholder:text-gray-400
        ${className}
      `}
      {...props} 
    />
  </div>
);
</file>

<file path="components/ui/PixelDatePicker.tsx">
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { ChevronLeft, ChevronRight, X, Calendar, Clock } from 'lucide-react';
import { format, addMonths, subMonths, startOfMonth, endOfMonth, eachDayOfInterval, isSameMonth, isSameDay, setHours, setMinutes, getDay } from 'date-fns';

interface PixelDatePickerProps {
  isOpen: boolean;
  onClose: () => void;
  selectedDate: Date;
  onSelectDate: (date: Date) => void;
  title?: string; // e.g. "DUE DATE" or "REMINDER"
  includeTime?: boolean;
}

export const PixelDatePicker: React.FC<PixelDatePickerProps> = ({ 
  isOpen, 
  onClose, 
  selectedDate, 
  onSelectDate,
  title = "SELECT DATE",
  includeTime = false
}) => {
  const [currentMonth, setCurrentMonth] = useState(new Date());
  const [tempDate, setTempDate] = useState(selectedDate);
  const [activeTab, setActiveTab] = useState<'DATE' | 'TIME'>('DATE');

  useEffect(() => {
    if (isOpen) {
      setTempDate(selectedDate);
      setCurrentMonth(selectedDate);
      setActiveTab('DATE');
    }
  }, [isOpen, selectedDate]);

  const daysInMonth = eachDayOfInterval({
    start: startOfMonth(currentMonth),
    end: endOfMonth(currentMonth)
  });

  // Calculate empty filler days for grid alignment
  const startDay = getDay(startOfMonth(currentMonth)); // 0 = Sunday
  const emptyDays = Array(startDay).fill(null);

  const handleTimeChange = (type: 'hours' | 'minutes', val: number) => {
    const newDate = new Date(tempDate);
    if (type === 'hours') newDate.setHours(val);
    else newDate.setMinutes(val);
    setTempDate(newDate);
  };

  const handleConfirm = () => {
    onSelectDate(tempDate);
    onClose();
  };

  return (
    <AnimatePresence>
      {isOpen && (
        <div className="fixed inset-0 z-[60] flex items-end md:items-center justify-center">
          {/* Retro Overlay with Dither Pattern */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="absolute inset-0 bg-black/40 backdrop-blur-[2px]"
            style={{
                backgroundImage: 'radial-gradient(#000 15%, transparent 16%), radial-gradient(#000 15%, transparent 16%)',
                backgroundSize: '4px 4px',
                backgroundPosition: '0 0, 2px 2px'
            }}
          />

          {/* Picker Container */}
          <motion.div
            initial={{ y: '100%' }}
            animate={{ y: 0 }}
            exit={{ y: '100%' }}
            transition={{ type: 'spring', damping: 25, stiffness: 300 }}
            className="relative w-full md:w-[380px] bg-white border-t-2 md:border-2 border-black p-4 md:rounded-lg shadow-[0_-4px_10px_rgba(0,0,0,0.2)] md:shadow-[8px_8px_0_0_#000]"
          >
             {/* Desktop Close Button (Floating) */}
             <button 
                onClick={onClose}
                className="absolute -top-12 md:top-2 right-4 md:right-2 bg-white md:bg-transparent border-2 border-black md:border-0 p-2 rounded-full md:rounded-none shadow-[2px_2px_0_0_#000] md:shadow-none hover:bg-gray-100 transition-transform active:translate-y-1"
             >
                 <X size={24} />
             </button>

             <h3 className="text-xl font-bold uppercase mb-4 text-center md:text-left">{title}</h3>

             {/* Tabs */}
             <div className="flex border-2 border-black mb-4">
                 <button 
                    onClick={() => setActiveTab('DATE')}
                    className={`flex-1 py-2 text-lg font-bold uppercase flex items-center justify-center gap-2 transition-colors ${activeTab === 'DATE' ? 'bg-black text-white' : 'hover:bg-gray-100'}`}
                 >
                    <Calendar size={18} /> Date
                 </button>
                 <button 
                    onClick={() => setActiveTab('TIME')}
                    className={`flex-1 py-2 text-lg font-bold uppercase flex items-center justify-center gap-2 transition-colors ${activeTab === 'TIME' ? 'bg-black text-white' : 'hover:bg-gray-100'}`}
                 >
                    <Clock size={18} /> Time
                 </button>
             </div>

             {activeTab === 'DATE' ? (
                 <>
                    {/* Month Nav */}
                    <div className="flex justify-between items-center mb-4 px-2">
                        <button onClick={() => setCurrentMonth(subMonths(currentMonth, 1))} className="p-1 hover:bg-gray-200 border-2 border-transparent hover:border-black transition-all">
                            <ChevronLeft />
                        </button>
                        <span className="text-2xl font-bold uppercase">{format(currentMonth, 'MMMM yyyy')}</span>
                        <button onClick={() => setCurrentMonth(addMonths(currentMonth, 1))} className="p-1 hover:bg-gray-200 border-2 border-transparent hover:border-black transition-all">
                            <ChevronRight />
                        </button>
                    </div>

                    {/* Calendar Grid */}
                    <div className="mb-4 select-none">
                        <div className="grid grid-cols-7 gap-1 mb-2 text-gray-500 font-bold text-center">
                            {['S','M','T','W','T','F','S'].map((d, i) => <span key={i}>{d}</span>)}
                        </div>
                        <div className="grid grid-cols-7 gap-1">
                            {emptyDays.map((_, i) => <div key={`empty-${i}`} />)}
                            {daysInMonth.map((date) => {
                                const isSelected = isSameDay(date, tempDate);
                                const isToday = isSameDay(date, new Date());
                                return (
                                    <div 
                                        key={date.toString()}
                                        onClick={() => setTempDate(prev => {
                                            const newD = new Date(date);
                                            newD.setHours(prev.getHours());
                                            newD.setMinutes(prev.getMinutes());
                                            return newD;
                                        })}
                                        className={`
                                            h-10 flex items-center justify-center cursor-pointer border-2 text-lg
                                            transition-all active:scale-95
                                            ${isSelected 
                                                ? 'bg-black text-white border-black' 
                                                : isToday 
                                                    ? 'border-black bg-white' 
                                                    : 'border-transparent hover:bg-gray-200'
                                            }
                                        `}
                                    >
                                        {format(date, 'd')}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                 </>
             ) : (
                 <div className="h-[312px] flex flex-col items-center justify-center space-y-6">
                     <div className="text-center">
                         <label className="block text-gray-500 font-bold mb-2 uppercase">Time</label>
                         <div className="flex items-center gap-2">
                             <select 
                                value={tempDate.getHours()}
                                onChange={(e) => handleTimeChange('hours', parseInt(e.target.value))}
                                className="text-4xl font-bold bg-gray-100 border-2 border-black p-2 outline-none appearance-none text-center w-24"
                             >
                                 {[...Array(24)].map((_, i) => (
                                     <option key={i} value={i}>{i.toString().padStart(2, '0')}</option>
                                 ))}
                             </select>
                             <span className="text-4xl font-bold">:</span>
                             <select 
                                value={Math.floor(tempDate.getMinutes() / 5) * 5}
                                onChange={(e) => handleTimeChange('minutes', parseInt(e.target.value))}
                                className="text-4xl font-bold bg-gray-100 border-2 border-black p-2 outline-none appearance-none text-center w-24"
                             >
                                 {[...Array(12)].map((_, i) => (
                                     <option key={i} value={i * 5}>{(i * 5).toString().padStart(2, '0')}</option>
                                 ))}
                             </select>
                         </div>
                     </div>
                     <div className="text-gray-500 text-sm">
                         Selected: {format(tempDate, 'MMM d, h:mm a')}
                     </div>
                 </div>
             )}

             {/* Actions */}
             <div className="flex gap-3 mt-2">
                 <button 
                    onClick={() => {
                        const today = new Date();
                        // Preserve time if in time mode, else reset? Let's just set date part
                        setTempDate(today);
                        setCurrentMonth(today);
                    }}
                    className="flex-1 border-2 border-black py-3 font-bold uppercase hover:bg-gray-100 transition-colors"
                 >
                    Today
                 </button>
                 <button 
                    onClick={handleConfirm}
                    className="flex-[2] bg-secondary border-2 border-black py-3 font-bold uppercase shadow-[2px_2px_0_0_#000] active:shadow-none active:translate-x-[2px] active:translate-y-[2px] transition-all hover:bg-green-400"
                 >
                    Confirm
                 </button>
             </div>

             {/* Mobile Safe Area */}
             <div className="h-6 md:hidden"></div>
          </motion.div>
        </div>
      )}
    </AnimatePresence>
  );
};
</file>

<file path="index.css">
@import "tailwindcss";
@config "./tailwind.config.js";

@layer base {
  body {
    @apply font-pixel bg-background-light dark:bg-background-dark text-gray-900 dark:text-gray-100 transition-colors duration-200;
    overscroll-behavior-y: none;
    -webkit-font-smoothing: none;
    image-rendering: pixelated;
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 10px;
}
::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-left: 2px solid #000;
}
::-webkit-scrollbar-thumb {
  background: #888;
  border: 2px solid #000;
}
::-webkit-scrollbar-thumb:hover {
  background: #555;
}
.pixel-antialiasing {
  image-rendering: pixelated;
}
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
    />
    <title>Pixel Tasks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-background-light dark:bg-background-dark text-gray-900 dark:text-gray-100 transition-colors duration-200"
  >
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>
</file>

<file path="index.tsx">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';

const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
</file>

<file path="metadata.json">
{
  "name": "Pixel Tasks",
  "description": "A gamified pixel-art Todo application with animal companions, arcade games, and RPG elements.",
  "requestFramePermissions": []
}
</file>

<file path="package.json">
{
  "name": "pixel-tasks",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "date-fns": "^4.1.0",
    "framer-motion": "^12.29.2",
    "lucide-react": "^0.563.0",
    "react": "^19.2.4",
    "react-dom": "^19.2.4",
    "react-router-dom": "^7.13.0",
    "uuid": "^13.0.0",
    "zustand": "^5.0.10"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.18",
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "autoprefixer": "^10.4.23",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}
</file>

<file path="pages/Achievements.tsx">
import React, { useState } from 'react';
import { useStore } from '../store';
import { PixelCard, PixelButton } from '../components/ui/PixelComponents';
import { Trophy, Lock, Zap } from 'lucide-react';
import { AnimatePresence, motion } from 'framer-motion';

export const Achievements: React.FC = () => {
  const { achievements, claimAchievement } = useStore();
  const [toastReward, setToastReward] = useState<number | null>(null);

  const handleClaim = (id: string, reward: number) => {
      claimAchievement(id);
      setToastReward(reward);
      
      // Auto hide toast after 2.5 seconds
      setTimeout(() => {
          setToastReward(null);
      }, 2500);
  };

  return (
    <div className="p-4 md:p-8 max-w-6xl mx-auto relative">
      
      {/* Toast Notification */}
      <AnimatePresence>
          {toastReward && (
              <motion.div 
                initial={{ opacity: 0, y: -50, x: '-50%' }}
                animate={{ opacity: 1, y: 0, x: '-50%' }}
                exit={{ opacity: 0, y: -20, x: '-50%' }}
                className="fixed top-24 left-1/2 bg-yellow-400 border-4 border-black shadow-[4px_4px_0_0_#000] px-8 py-4 z-50 flex flex-col items-center min-w-[300px]"
              >
                  <h3 className="text-3xl font-bold animate-bounce uppercase">Level Up!</h3>
                  <p className="text-xl font-bold">
                      +<span className="text-white bg-black px-2 mx-1">{toastReward}</span> XP Added to wallet
                  </p>
              </motion.div>
          )}
      </AnimatePresence>

      <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-12 gap-6">
        <div>
            <h1 className="text-5xl md:text-6xl font-bold uppercase tracking-widest mb-2" style={{ textShadow: '2px 2px 0px rgba(0,0,0,0.1)' }}>Hall of Fame</h1>
            <p className="text-2xl text-gray-600 dark:text-gray-400">Track your legacy, Adventurer!</p>
        </div>
        
        <div className="bg-yellow-50 dark:bg-card-dark border-2 border-black dark:border-white shadow-pixel p-4 min-w-[300px]">
             <div className="grid grid-cols-3 divide-x-2 divide-black dark:divide-white text-center">
                 <div className="px-4">
                     <div className="text-gray-500 text-lg uppercase">Total XP</div>
                     <div className="text-3xl font-bold text-orange-500">12k</div>
                 </div>
                 <div className="px-4">
                     <div className="text-gray-500 text-lg uppercase">Badges</div>
                     <div className="text-3xl font-bold text-blue-500">8<span className="text-gray-400 text-xl">/24</span></div>
                 </div>
                 <div className="px-4">
                     <div className="text-gray-500 text-lg uppercase">Comp</div>
                     <div className="text-3xl font-bold text-green-500">33%</div>
                 </div>
             </div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {achievements.map((ach) => (
           <PixelCard 
             key={ach.id} 
             className={`
                flex flex-col justify-between transition-all duration-300
                ${ach.status === 'LOCKED' ? 'opacity-70 bg-gray-100 dark:bg-gray-800' : ''}
                ${ach.status === 'CLAIMABLE' ? 'border-4 border-yellow-400 transform hover:-translate-y-1' : ''}
             `}
           >
              {ach.status === 'CLAIMABLE' && (
                  <div className="absolute -top-3 -right-3 bg-red-500 text-white w-8 h-8 flex items-center justify-center border-2 border-black z-10 font-bold text-xl animate-bounce">!</div>
              )}

              <div className="flex items-start gap-4 mb-4">
                 <div className={`
                    w-16 h-16 border-2 border-black flex items-center justify-center text-3xl shrink-0
                    ${ach.status === 'LOCKED' ? 'bg-gray-300' : 'bg-blue-100'}
                 `}>
                    {ach.status === 'LOCKED' ? <Lock /> : <Trophy className="text-yellow-600" />}
                 </div>
                 <div>
                    <h3 className="text-2xl font-bold uppercase leading-none mb-1">{ach.title}</h3>
                    <p className="text-lg text-gray-500 leading-tight">{ach.status === 'LOCKED' ? '???' : ach.description}</p>
                 </div>
              </div>

              <div>
                  <div className="flex justify-between text-lg font-bold mb-1 uppercase">
                      <span>Progress</span>
                      <span>{ach.progress} / {ach.maxProgress}</span>
                  </div>
                  <div className="w-full h-6 border-2 border-black bg-white relative">
                      <div 
                        className="h-full bg-green-400 border-r-2 border-black transition-all duration-500" 
                        style={{ width: `${(ach.progress / ach.maxProgress) * 100}%` }}
                      ></div>
                  </div>
                  
                  {ach.status === 'CLAIMABLE' && (
                      <PixelButton 
                        fullWidth 
                        className="mt-4" 
                        variant="primary"
                        onClick={() => handleClaim(ach.id, ach.reward)}
                      >
                         <Zap size={18} /> CLAIM {ach.reward} XP
                      </PixelButton>
                  )}
                  {ach.status === 'COMPLETED' && (
                      <div className="mt-4 text-center p-2 bg-gray-100 dark:bg-gray-700 border-2 border-transparent text-green-600 dark:text-green-400 font-bold uppercase flex items-center justify-center gap-2">
                          <CheckIcon /> Completed
                      </div>
                  )}
              </div>
           </PixelCard>
        ))}
      </div>
    </div>
  );
};

const CheckIcon = () => (
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
)
</file>

<file path="pages/CharacterCreation.tsx">
import React, { useState } from 'react';
import { useStore } from '../store';
import { PixelButton, PixelCard, PixelInput } from '../components/ui/PixelComponents';
import { CompanionType } from '../types';
import { motion } from 'framer-motion';

export const CharacterCreation: React.FC = () => {
  const login = useStore(state => state.login);
  // Default to Login mode (true) instead of Creation mode (false)
  const [isLoginMode, setIsLoginMode] = useState(true);
  const [name, setName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [companion, setCompanion] = useState<CompanionType>(CompanionType.DOG);

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (isLoginMode) {
      if (email && password) {
        // Mock login with default data since we don't have a real backend
        login('Returned Hero', email, CompanionType.DOG);
      }
    } else {
      if (name && email && password) {
        login(name, email, companion);
      }
    }
  };

  // Pixel Cloud SVG
  const PixelCloud = ({ className }: { className?: string }) => (
    <svg 
      viewBox="0 0 64 32" 
      className={className} 
      style={{ imageRendering: 'pixelated' }} 
      fill="white" 
      xmlns="http://www.w3.org/2000/svg"
    >
        {/* Blocky cloud shape */}
        <path d="M12 20 h-8 v-8 h8 v-4 h8 v-4 h20 v4 h12 v4 h8 v12 h-48 Z" fill="white" />
        <path d="M12 20 h-8 v-8 h8 v-4 h8 v-4 h20 v4 h12 v4 h8 v12 h-48 Z" fill="rgba(0,0,0,0.05)" transform="translate(4,4)" />
    </svg>
  );

  return (
    <div className="min-h-screen relative flex items-center justify-center p-4 overflow-hidden bg-[#63b4ff]">
      
      {/* --- Sky Layer --- */}
      <div className="absolute inset-0 z-0">
          {/* Stars/Sparkles */}
          <motion.div animate={{ opacity: [0.5, 1, 0.5] }} transition={{ duration: 2, repeat: Infinity }} className="absolute top-10 left-10 text-white text-2xl">‚ú¶</motion.div>
          <motion.div animate={{ opacity: [0.3, 0.8, 0.3] }} transition={{ duration: 3, repeat: Infinity, delay: 1 }} className="absolute top-24 right-24 text-white text-xl">‚ú®</motion.div>
          <motion.div animate={{ opacity: [0.4, 0.9, 0.4] }} transition={{ duration: 2.5, repeat: Infinity, delay: 0.5 }} className="absolute top-40 left-1/4 text-white text-lg">‚ú¶</motion.div>
          
          {/* Drifting Clouds */}
          <motion.div 
            initial={{ x: '-20%' }} 
            animate={{ x: '120%' }} 
            transition={{ duration: 45, repeat: Infinity, ease: 'linear' }}
            className="absolute top-12 w-48 opacity-90"
          >
             <PixelCloud className="w-full drop-shadow-md" />
          </motion.div>
          
          <motion.div 
            initial={{ x: '-20%' }} 
            animate={{ x: '120%' }} 
            transition={{ duration: 60, repeat: Infinity, ease: 'linear', delay: 20 }}
            className="absolute top-32 w-32 opacity-80"
          >
             <PixelCloud className="w-full drop-shadow-sm" />
          </motion.div>

          <motion.div 
            initial={{ x: '-20%' }} 
            animate={{ x: '120%' }} 
            transition={{ duration: 35, repeat: Infinity, ease: 'linear', delay: 10 }}
            className="absolute top-8 right-0 w-24 opacity-70"
          >
             <PixelCloud className="w-full" />
          </motion.div>
      </div>

      {/* --- Landscape Layer --- */}
      
      {/* Far Hills */}
      <div className="absolute bottom-[100px] w-full flex items-end z-0 pointer-events-none opacity-90">
           {/* CSS Triangles for mountains */}
           <div className="w-0 h-0 border-l-[15vw] border-l-transparent border-r-[15vw] border-r-transparent border-b-[20vh] border-b-[#86efac] -ml-[5vw]"></div>
           <div className="w-0 h-0 border-l-[20vw] border-l-transparent border-r-[20vw] border-r-transparent border-b-[30vh] border-b-[#4ade80] -ml-[10vw]"></div>
           <div className="w-0 h-0 border-l-[25vw] border-l-transparent border-r-[25vw] border-r-transparent border-b-[25vh] border-b-[#22c55e] ml-auto -mr-[5vw]"></div>
      </div>

      {/* Pasture Ground */}
      <div className="absolute bottom-0 w-full h-[120px] bg-[#4ade80] border-t-8 border-[#16a34a] z-0 shadow-lg">
          {/* Pattern */}
          <div className="w-full h-full opacity-10" style={{ backgroundImage: 'radial-gradient(#000 2px, transparent 2px)', backgroundSize: '24px 24px' }}></div>
      </div>

      {/* Trees & Decor */}
      <div className="absolute bottom-[100px] w-full flex justify-between px-4 z-0 pointer-events-none">
          {/* Left Trees */}
          <div className="flex items-end -space-x-8">
             <PixelTree scale={1.2} />
             <PixelTree color="#15803d" />
             <PixelTree scale={0.8} color="#14532d" />
          </div>
          
          {/* Right Trees */}
          <div className="flex items-end -space-x-6">
             <PixelTree color="#15803d" scale={0.9} />
             <PixelTree scale={1.1} />
          </div>
      </div>

      {/* --- Main Login Card --- */}
      <motion.div 
        initial={{ scale: 0.9, opacity: 0, y: 20 }}
        animate={{ scale: 1, opacity: 1, y: 0 }}
        transition={{ duration: 0.6, type: 'spring', bounce: 0.4 }}
        className="z-10 w-full max-w-sm"
      >
        <PixelCard className="bg-white/95 backdrop-blur-sm border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,0.25)]">
          <div className="text-center mb-6">
            <h1 className="text-3xl font-bold uppercase mb-1 tracking-wide text-black font-pixel">Pixel Tasks</h1>
            <p className="text-gray-500 font-pixel text-lg">
              {isLoginMode ? 'Welcome back, Adventurer!' : 'Start your collection journey.'}
            </p>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            
            {/* Companion Selection - Only in Sign Up */}
            {!isLoginMode && (
              <div className="flex justify-center gap-4 mb-4">
                 {[
                   { type: CompanionType.DOG, emoji: 'üê∂', label: 'Dog' },
                   { type: CompanionType.CAT, emoji: 'üê±', label: 'Cat' }
                 ].map((opt) => (
                   <div 
                      key={opt.type}
                      onClick={() => setCompanion(opt.type)}
                      className={`
                        cursor-pointer w-24 h-24 flex flex-col items-center justify-center rounded-lg border-3 transition-all
                        ${companion === opt.type 
                          ? 'bg-yellow-50 border-primary shadow-pixel-sm scale-105' 
                          : 'bg-white border-gray-200 hover:border-gray-400 opacity-70 hover:opacity-100'
                        }
                      `}
                   >
                      <div className="text-4xl mb-1">{opt.emoji}</div>
                      <span className="text-xs font-bold uppercase text-gray-600">{opt.label}</span>
                   </div>
                 ))}
              </div>
            )}

            <div className="space-y-3">
               {!isLoginMode && (
                 <PixelInput 
                   label="Hero Name"
                   required
                   placeholder="e.g. Ash Ketchum"
                   value={name}
                   onChange={(e) => setName(e.target.value)}
                   className="bg-gray-50 focus:bg-white"
                 />
               )}
               
               <PixelInput 
                 label="Email"
                 type="email" 
                 required
                 placeholder="hero@example.com"
                 value={email}
                 onChange={(e) => setEmail(e.target.value)}
                 className="bg-gray-50 focus:bg-white"
               />

               <PixelInput 
                 label="Password"
                 type="password" 
                 required
                 placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                 value={password}
                 onChange={(e) => setPassword(e.target.value)}
                 className="bg-gray-50 focus:bg-white"
               />
            </div>

            <PixelButton type="submit" fullWidth className="mt-4 py-3 text-xl bg-primary hover:bg-yellow-400 border-black text-black shadow-pixel hover:shadow-pixel-sm transition-transform hover:-translate-y-1">
              {isLoginMode ? 'Resume Adventure' : 'Start Adventure'}
            </PixelButton>
          </form>
          
          <div className="mt-6 text-center">
             <span className="text-gray-600 font-bold font-pixel text-lg block sm:inline mb-1 sm:mb-0 mr-1">
                {isLoginMode ? "New here?" : "Already have a save file?"}
             </span>
             <button 
                type="button" 
                onClick={() => setIsLoginMode(!isLoginMode)}
                className="text-primary hover:text-yellow-600 font-bold uppercase tracking-wide underline decoration-2 underline-offset-4"
             >
                {isLoginMode ? "CREATE CHARACTER" : "LOG IN"}
             </button>
          </div>
        </PixelCard>
      </motion.div>
    </div>
  );
};

// Simple Pixel Tree Component using CSS borders
const PixelTree = ({ color = '#16a34a', scale = 1 }) => (
    <div className="relative flex flex-col items-center" style={{ transform: `scale(${scale})` }}>
        {/* Leaves */}
        <div 
          className="w-0 h-0 border-l-[25px] border-l-transparent border-r-[25px] border-r-transparent border-b-[50px] relative z-20 drop-shadow-sm"
          style={{ borderBottomColor: color }}
        ></div>
        <div 
          className="w-0 h-0 border-l-[35px] border-l-transparent border-r-[35px] border-r-transparent border-b-[60px] -mt-8 relative z-10 drop-shadow-sm"
          style={{ borderBottomColor: color }}
        ></div>
        {/* Trunk */}
        <div className="w-4 h-8 bg-[#78350f] border-2 border-[#451a03] -mt-2"></div>
    </div>
);
</file>

<file path="pages/Dashboard.tsx">
import React, { useState, useEffect } from 'react';
import { useStore } from '../store';
import { PixelCard, PixelButton, PixelModal, PixelInput } from '../components/ui/PixelComponents';
import { PixelDatePicker } from '../components/ui/PixelDatePicker';
import { Task, TaskCategory, TaskPriority } from '../types';
import { Check, Star, Calendar, Trash2, Edit3, Clock, Flag, Briefcase, Heart, Gamepad2, Home, Plus, ChevronDown, ChevronUp, Bell, List, MoreVertical, ArrowDownAZ, AlertCircle, Type, CheckCircle, Settings, MoreHorizontal } from 'lucide-react';
import { format, isToday, isTomorrow, isYesterday } from 'date-fns';
import { v4 as uuidv4 } from 'uuid';

interface DashboardProps {
    isEditorOpen: boolean;
    onCloseEditor: () => void;
}

type SortCriteria = 'DATE' | 'DEADLINE' | 'PRIORITY' | 'TITLE';

export const Dashboard: React.FC<DashboardProps> = ({ isEditorOpen, onCloseEditor }) => {
  const { user, tasks, toggleTask, addTask, deleteTask, updateTask, customLists, addList, renameList, deleteList, deleteCompletedTasks } = useStore();
  
  // Default List Name
  const defaultListName = user ? `${user.name}'s List` : "Hero's List";

  // Filter & List State
  const [filter, setFilter] = useState<string>(defaultListName);
  const [sortCriteria, setSortCriteria] = useState<SortCriteria>('DATE');
  const [showCompleted, setShowCompleted] = useState(false);
  
  // Card Expansion State
  const [expandedTaskId, setExpandedTaskId] = useState<string | null>(null);

  // Task Options Menu State
  const [activeTaskMenu, setActiveTaskMenu] = useState<{ taskId: string, top: number, left: number } | null>(null);
  const [reschedulingTaskId, setReschedulingTaskId] = useState<string | null>(null);

  // List Menu State
  const [activeMenu, setActiveMenu] = useState<{ id: string, top: number, left: number } | null>(null);
  
  // List Creation/Rename State
  const [isListModalOpen, setListModalOpen] = useState(false);
  const [listModalMode, setListModalMode] = useState<'CREATE' | 'RENAME'>('CREATE');
  const [listNameInput, setListNameInput] = useState('');
  const [listToRename, setListToRename] = useState('');

  // Editor State
  const [newTaskTitle, setNewTaskTitle] = useState('');
  const [newTaskDesc, setNewTaskDesc] = useState('');
  const [newTaskCategory, setNewTaskCategory] = useState<TaskCategory>(TaskCategory.WORK);
  const [newTaskPriority, setNewTaskPriority] = useState<TaskPriority>(TaskPriority.MEDIUM);
  const [newTaskDate, setNewTaskDate] = useState<Date>(new Date());
  
  const [selectedList, setSelectedList] = useState(defaultListName);

  useEffect(() => {
      if (!isEditorOpen) {
          setSelectedList(defaultListName);
      }
  }, [isEditorOpen, defaultListName]);
  
  // Date Picker State
  const [isDatePickerOpen, setDatePickerOpen] = useState(false);
  const [pickerMode, setPickerMode] = useState<'DUE' | 'REMINDER'>('DUE');
  const [reminderDate, setReminderDate] = useState<Date | null>(null);

  const handleSaveTask = () => {
    if (!newTaskTitle) return;

    const isDaily = selectedList === 'Daily Quests';
    const isDefault = selectedList === defaultListName;
    const listAssignment = (isDaily || isDefault) ? undefined : selectedList;

    addTask({
        id: uuidv4(),
        title: newTaskTitle,
        description: newTaskDesc,
        category: newTaskCategory,
        priority: newTaskPriority,
        xpReward: newTaskPriority === TaskPriority.HIGH ? 500 : newTaskPriority === TaskPriority.MEDIUM ? 250 : 100,
        completed: false,
        dueDate: newTaskDate.toISOString(),
        isDaily: isDaily,
        list: listAssignment
    });
    
    setNewTaskTitle('');
    setNewTaskDesc('');
    setNewTaskDate(new Date());
    setReminderDate(null);
    onCloseEditor();
  };

  const openCreateList = () => {
      setListModalMode('CREATE');
      setListNameInput('');
      setListModalOpen(true);
  };

  const openRenameList = (oldName: string) => {
      setListModalMode('RENAME');
      setListToRename(oldName);
      setListNameInput(oldName);
      setListModalOpen(true);
      setActiveMenu(null);
  };

  const handleListModalSave = () => {
      if (!listNameInput.trim()) return;

      if (listModalMode === 'CREATE') {
          addList(listNameInput.trim());
          setFilter(listNameInput.trim());
      } else {
          renameList(listToRename, listNameInput.trim());
          if (filter === listToRename) setFilter(listNameInput.trim());
      }
      setListModalOpen(false);
  };

  const handleDeleteList = (name: string) => {
      if (confirm(`Are you sure you want to delete "${name}" and all its tasks?`)) {
          deleteList(name);
          setFilter(defaultListName);
          setActiveMenu(null);
      }
  };

  const handleClearCompleted = (listName: string) => {
      if (confirm(`Clear all completed tasks in "${listName}"?`)) {
          deleteCompletedTasks(listName);
          setActiveMenu(null);
      }
  }

  const handleMoveTask = (taskId: string, targetList: string) => {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;

      let updates: Partial<Task> = {};
      
      if (targetList === 'Daily Quests') {
          updates = { isDaily: true, list: undefined };
      } else if (targetList === defaultListName) {
          updates = { isDaily: false, list: undefined };
      } else {
          updates = { isDaily: false, list: targetList };
      }
      
      updateTask({ ...task, ...updates });
      setActiveTaskMenu(null);
  };

  const getCategoryIcon = (cat: TaskCategory) => {
      switch(cat) {
          case TaskCategory.WORK: return <Briefcase size={14} />;
          case TaskCategory.HEALTH: return <Heart size={14} />;
          case TaskCategory.FUN: return <Gamepad2 size={14} />;
          case TaskCategory.CHORE: return <Home size={14} />;
      }
  };

  const getCategoryColor = (cat: TaskCategory) => {
      switch(cat) {
          case TaskCategory.WORK: return 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300';
          case TaskCategory.HEALTH: return 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300';
          case TaskCategory.FUN: return 'bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300';
          case TaskCategory.CHORE: return 'bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300';
      }
  };

  const formatSmartDate = (dateString: string) => {
      const date = new Date(dateString);
      if (isToday(date)) return 'Today';
      if (isTomorrow(date)) return 'Tomorrow';
      if (isYesterday(date)) return 'Yesterday';
      return format(date, 'MMM d');
  };

  // 1. Filter Logic
  let processedTasks = tasks.filter(t => {
      if (filter === defaultListName) return !t.isDaily && !t.list;
      if (filter === 'DAILY') return t.isDaily;
      return t.list === filter;
  });

  // 2. Sort Logic
  processedTasks = processedTasks.sort((a, b) => {
      switch(sortCriteria) {
          case 'TITLE': 
              return a.title.localeCompare(b.title);
          case 'PRIORITY':
              const pMap = { [TaskPriority.HIGH]: 3, [TaskPriority.MEDIUM]: 2, [TaskPriority.LOW]: 1 };
              return pMap[b.priority] - pMap[a.priority];
          case 'DEADLINE': 
              return new Date(a.dueDate).getTime() - new Date(b.dueDate).getTime();
          case 'DATE': 
          default:
              return a.id.localeCompare(b.id);
      }
  });

  const activeTasks = processedTasks.filter(t => !t.completed);
  const completedTasks = processedTasks.filter(t => t.completed);
  const totalDaily = tasks.filter(t => t.isDaily).length;

  const openPicker = (mode: 'DUE' | 'REMINDER') => {
      setPickerMode(mode);
      setDatePickerOpen(true);
  };

  const handleDateSelect = (date: Date) => {
      if (pickerMode === 'DUE') {
          setNewTaskDate(date);
      } else {
          setReminderDate(date);
      }
  };

  const renderTask = (task: Task) => {
      const isExpanded = expandedTaskId === task.id;
      const isMenuOpen = activeTaskMenu?.taskId === task.id;

      return (
        <div 
            key={task.id} 
            className={`relative transition-all duration-200 ${isExpanded ? 'z-20 my-4' : 'z-0'}`}
        >
            <PixelCard 
                onClick={() => setExpandedTaskId(isExpanded ? null : task.id)}
                className={`
                    flex flex-row gap-3 group transition-all duration-300 cursor-pointer
                    ${task.completed ? 'opacity-75 grayscale-[0.5]' : ''}
                    ${isExpanded 
                        ? 'p-6 scale-[1.02] shadow-pixel-lg border-primary ring-2 ring-primary ring-offset-2 ring-offset-background-light dark:ring-offset-background-dark' 
                        : 'p-3 hover:-translate-y-1 items-center'
                    }
                `}
            >
                {/* Priority Badge (Expanded Only) */}
                {task.priority === TaskPriority.HIGH && !task.completed && isExpanded && (
                    <div className="absolute -top-3 -right-2 bg-accent text-white text-xs font-bold px-2 py-1 border-2 border-black shadow-sm rotate-3 z-10">
                        BOSS!
                    </div>
                )}

                {/* Checkbox Area */}
                <div className={`${isExpanded ? 'pt-1' : ''} shrink-0`}>
                    <div 
                        onClick={(e) => {
                            e.stopPropagation();
                            toggleTask(task.id);
                        }}
                        className={`
                            border-3 border-black dark:border-white cursor-pointer flex items-center justify-center transition-colors
                            ${isExpanded ? 'w-8 h-8' : 'w-6 h-6'}
                            ${task.completed ? 'bg-secondary' : 'bg-white dark:bg-gray-800 hover:bg-gray-100'}
                        `}
                    >
                        {task.completed && <Check strokeWidth={4} className="text-black" size={isExpanded ? 20 : 16} />}
                    </div>
                </div>

                {/* Content */}
                <div className="flex-1 min-w-0 pr-12">
                    <div className={`flex ${isExpanded ? 'justify-between items-start mb-2' : 'items-center gap-3'}`}>
                        {/* Title & Stars */}
                        <div className="flex items-center gap-2 overflow-hidden min-w-0">
                            <h3 className={`font-bold leading-none truncate ${isExpanded ? 'text-2xl' : 'text-lg'} ${task.completed ? 'line-through text-gray-500' : ''}`}>
                                {task.title}
                            </h3>
                            <div className={`flex gap-0.5 shrink-0 ${isExpanded ? '' : 'scale-75 origin-left'}`}>
                                {[...Array(task.priority === 'High' ? 3 : task.priority === 'Medium' ? 2 : 1)].map((_, i) => (
                                    <Star key={i} size={16} className="text-yellow-500 fill-yellow-500" />
                                ))}
                            </div>
                        </div>

                        {/* Compact Metadata (Right Side) - Visible only when NOT expanded */}
                        {!isExpanded && (
                            <div className="flex items-center gap-3 text-xs font-bold text-gray-500 shrink-0">
                                <div className={`flex items-center gap-1 px-1.5 py-0.5 border border-black/20 rounded ${getCategoryColor(task.category)} bg-opacity-40`}>
                                     {getCategoryIcon(task.category)}
                                     <span className="uppercase hidden sm:inline">{task.category}</span>
                                </div>
                                <div className="flex items-center gap-1 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded border border-black/10">
                                    <Calendar size={12} />
                                    <span>{formatSmartDate(task.dueDate)}</span>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Description - Conditional Truncation */}
                    {task.description && (
                        <p className={`
                            text-gray-600 dark:text-gray-300 transition-all
                            ${task.completed ? 'text-gray-400' : ''}
                            ${isExpanded 
                                ? 'text-lg mb-4 whitespace-pre-wrap' 
                                : 'text-sm truncate mb-0 w-[90%]' 
                            }
                        `}>
                            {task.description}
                        </p>
                    )}

                    {/* Full Metadata - Only when Expanded */}
                    {isExpanded && (
                        <div className="flex flex-wrap items-center gap-3 text-sm font-bold animate-in fade-in slide-in-from-top-2 duration-300">
                             <div className={`flex items-center gap-1 px-2 py-0.5 border-2 border-black dark:border-white ${getCategoryColor(task.category)}`}>
                                 {getCategoryIcon(task.category)}
                                 <span className="uppercase">{task.category}</span>
                             </div>
                             
                             <div className="flex items-center gap-1 text-gray-500 dark:text-gray-400">
                                 <Calendar size={16} />
                                 <span>{format(new Date(task.dueDate), 'MMM d, h:mm a')}</span>
                             </div>

                             {task.list && (
                                 <div className="flex items-center gap-1 text-gray-500 dark:text-gray-400 border-l-2 border-gray-300 pl-2 ml-1">
                                     <List size={16} />
                                     <span className="uppercase">{task.list}</span>
                                 </div>
                             )}

                             <div className="ml-auto flex items-center gap-1 bg-yellow-100 dark:bg-yellow-900 border border-black dark:border-gray-500 px-2 rounded-sm text-yellow-700 dark:text-yellow-400">
                                 <span className="text-xs">‚ö°</span>
                                 <span>{task.xpReward} XP</span>
                             </div>
                        </div>
                    )}
                </div>
                
                {/* Task Menu Action Button */}
                <button 
                    onClick={(e) => { 
                        e.stopPropagation(); 
                        const rect = e.currentTarget.getBoundingClientRect();
                        // Adjust to open towards the left to keep on screen
                        setActiveTaskMenu({
                            taskId: task.id,
                            top: rect.bottom + 4,
                            left: rect.right - 220 // Align right side roughly
                        });
                    }}
                    className={`
                        absolute top-2 right-2 p-2 text-gray-400 hover:text-black dark:hover:text-white transition-opacity z-10 opacity-100
                    `}
                >
                    <MoreVertical size={20} />
                </button>
            </PixelCard>
        </div>
      );
  };

  const allTabs = [defaultListName, 'DAILY', ...customLists];
  const isSystemTab = (name: string) => [defaultListName, 'DAILY'].includes(name);

  return (
    <div className="p-4 md:p-8 max-w-5xl mx-auto">
      {/* Global Click Outside Handler for Cards & Menus */}
      {(expandedTaskId || activeTaskMenu) && (
          <div 
            className="fixed inset-0 z-10 cursor-default"
            onClick={() => {
                setExpandedTaskId(null);
                setActiveTaskMenu(null);
            }}
          />
      )}

      {/* Header Stats */}
      <div className="mb-8">
        <div className="flex justify-between items-end mb-2">
            <div>
                <h2 className="text-3xl font-bold uppercase tracking-wide">
                    {filter === defaultListName ? 'My Quests' : filter === 'DAILY' ? 'Daily Quests' : filter}
                </h2>
                <div className="flex gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1">
                    <Clock size={16} /> 
                    <span>Resets in 12h 30m</span>
                </div>
            </div>
            <div className="text-right">
                <p className="text-xl font-bold">{tasks.filter(t => t.completed && t.isDaily).length}/{totalDaily} Completed</p>
            </div>
        </div>
        
        {/* Progress Bar */}
        <div className="w-full h-6 bg-gray-200 dark:bg-gray-700 border-2 border-black dark:border-white rounded-none relative overflow-hidden">
             <div 
                className="absolute top-0 left-0 h-full bg-secondary transition-all duration-500"
                style={{ width: `${totalDaily > 0 ? (tasks.filter(t => t.completed && t.isDaily).length / totalDaily) * 100 : 0}%` }}
             >
                <div className="w-full h-full" style={{ backgroundImage: 'linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)', backgroundSize: '1rem 1rem' }}></div>
             </div>
        </div>
      </div>

      {/* Filter Tabs */}
      <div className="flex items-center mb-6 border-b-2 border-dashed border-gray-300 dark:border-gray-700 pb-2">
        <div className="flex-1 relative min-w-0">
            <div className="flex overflow-x-auto gap-4 pb-2 pr-8 no-scrollbar items-center">
                {allTabs.map((f) => {
                    const isActive = filter === f;
                    const isMenuOpen = activeMenu?.id === f;
                    
                    return (
                        <div key={f} className="relative group shrink-0">
                            <div
                                onClick={() => setFilter(f)}
                                className={`
                                    flex items-center gap-2 pl-6 pr-2 py-2 text-xl font-bold uppercase border-2 border-black dark:border-white transition-all cursor-pointer select-none
                                    ${isActive 
                                        ? 'bg-primary text-black shadow-pixel' 
                                        : 'bg-white dark:bg-card-dark text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800'
                                    }
                                `}
                            >
                                <span>{f}</span>
                                <button 
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        if (isMenuOpen) {
                                            setActiveMenu(null);
                                        } else {
                                            const rect = e.currentTarget.getBoundingClientRect();
                                            setActiveMenu({
                                                id: f,
                                                top: rect.bottom + 8, 
                                                left: rect.left
                                            });
                                        }
                                    }}
                                    className={`
                                        p-1 rounded hover:bg-black/10 dark:hover:bg-white/20 transition-colors
                                        ${isMenuOpen ? 'bg-black/10' : ''}
                                    `}
                                >
                                    <MoreVertical size={16} />
                                </button>
                            </div>
                        </div>
                    );
                })}
            </div>
            <div className="absolute right-0 top-0 bottom-2 w-12 bg-gradient-to-l from-background-light dark:from-background-dark to-transparent pointer-events-none"></div>
        </div>
        <div className="w-[2px] h-8 bg-gray-300 dark:bg-gray-600 mx-2 md:mx-4 shrink-0"></div>
        <button 
            className="shrink-0 w-11 h-11 bg-white dark:bg-card-dark border-2 border-black dark:border-white shadow-pixel-sm hover:shadow-pixel hover:-translate-y-0.5 active:translate-y-0.5 active:shadow-none transition-all flex items-center justify-center text-black dark:text-white"
            title="Create New List"
            onClick={openCreateList} 
        >
            <Plus size={24} strokeWidth={3} />
        </button>
      </div>

      {/* Task List Section */}
      <div className="space-y-4">
        {/* Active Tasks */}
        <div className="grid grid-cols-1 gap-3">
            {activeTasks.map(renderTask)}
        </div>
        
        {/* Empty Active State */}
        {activeTasks.length === 0 && completedTasks.length === 0 && (
            <div className="text-center py-12 border-4 border-dashed border-gray-300 dark:border-gray-700 rounded-lg">
                <p className="text-2xl text-gray-400 uppercase">No quests found here.</p>
                <p className="text-gray-500 mt-2">Create a new task to fill this list!</p>
            </div>
        )}

        {activeTasks.length === 0 && completedTasks.length > 0 && (
             <div className="text-center py-8">
                 <p className="text-xl text-gray-400 uppercase font-bold">All Active Quests Completed!</p>
             </div>
        )}

        {/* Completed Section Separator & Toggle */}
        {completedTasks.length > 0 && (
            <div className="pt-2">
                <button 
                    onClick={() => setShowCompleted(!showCompleted)}
                    className="w-full flex items-center justify-between text-gray-500 dark:text-gray-400 font-bold uppercase tracking-wider py-4 hover:text-black dark:hover:text-white transition-colors group"
                >
                    <span className="flex items-center gap-2">
                        Completed ({completedTasks.length})
                    </span>
                    <div className="flex items-center gap-2">
                        <span className="text-sm opacity-0 group-hover:opacity-100 transition-opacity">
                            {showCompleted ? 'COLLAPSE' : 'EXPAND'}
                        </span>
                        {showCompleted ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                    </div>
                </button>

                {/* Collapsible Content */}
                {showCompleted && (
                    <div className="grid grid-cols-1 gap-3 animate-in slide-in-from-top-2 duration-300">
                        {completedTasks.map(renderTask)}
                    </div>
                )}
            </div>
        )}
      </div>

      {/* List Options Menu */}
      {activeMenu && (
        <div className="fixed inset-0 z-[100]">
            <div 
                className="absolute inset-0 cursor-default" 
                onClick={() => setActiveMenu(null)}
            />
            <div 
                style={{ top: activeMenu.top, left: activeMenu.left }}
                className="absolute bg-white dark:bg-gray-800 border-4 border-black dark:border-white shadow-[8px_8px_0_0_#000] p-6 w-[360px] max-w-[90vw] animate-in fade-in zoom-in-95 duration-200 origin-top-left"
            >
                <div className="text-center mb-4 border-b-2 border-dashed border-gray-300 dark:border-gray-600 pb-2">
                    <h3 className="text-xl font-bold uppercase">{activeMenu.id} Options</h3>
                </div>
                {/* ... existing list options ... */}
                 <div className="grid grid-cols-2 gap-6">
                    <div>
                         <h4 className="text-xs font-bold text-gray-400 uppercase mb-3 flex items-center gap-1">
                            <ArrowDownAZ size={14} /> Sort By
                         </h4>
                         <div className="space-y-2">
                            {/* Sort Options */}
                            {[
                                { id: 'DATE', label: 'Date', icon: <Calendar size={16}/> },
                                { id: 'DEADLINE', label: 'Deadline', icon: <Clock size={16}/> },
                                { id: 'PRIORITY', label: 'Priority', icon: <AlertCircle size={16}/> },
                                { id: 'TITLE', label: 'Title', icon: <Type size={16}/> },
                            ].map((opt) => (
                                <button
                                    key={opt.id}
                                    onClick={() => {
                                        setSortCriteria(opt.id as SortCriteria);
                                        setActiveMenu(null);
                                    }}
                                    className={`
                                        w-full text-left px-3 py-2 text-sm font-bold uppercase flex items-center gap-2 border-2 transition-all
                                        ${sortCriteria === opt.id 
                                            ? 'bg-black text-white border-black dark:bg-white dark:text-black' 
                                            : 'border-transparent hover:border-black hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300'
                                        }
                                    `}
                                >
                                    {opt.icon}
                                    {opt.label}
                                </button>
                            ))}
                         </div>
                    </div>

                    <div>
                        <h4 className="text-xs font-bold text-gray-400 uppercase mb-3 flex items-center gap-1">
                            <Settings size={14} /> Actions
                        </h4>
                        <div className="space-y-2">
                            {!isSystemTab(activeMenu.id) && (
                                <>
                                    <button 
                                        onClick={() => openRenameList(activeMenu.id)}
                                        className="w-full text-left px-3 py-2 text-sm font-bold uppercase flex items-center gap-2 border-2 border-transparent hover:border-black hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-gray-300 transition-all"
                                    >
                                        <Edit3 size={16} /> Rename
                                    </button>
                                    <button 
                                        onClick={() => handleDeleteList(activeMenu.id)}
                                        className="w-full text-left px-3 py-2 text-sm font-bold uppercase flex items-center gap-2 border-2 border-transparent hover:border-red-500 hover:text-red-500 hover:bg-red-50 text-red-500 transition-all"
                                    >
                                        <Trash2 size={16} /> Delete
                                    </button>
                                </>
                            )}
                            <button 
                                onClick={() => handleClearCompleted(activeMenu.id)}
                                className="w-full text-left px-3 py-2 text-sm font-bold uppercase flex items-center gap-2 border-2 border-transparent hover:border-yellow-500 hover:text-yellow-600 hover:bg-yellow-50 text-yellow-600 dark:text-yellow-400 transition-all"
                            >
                                <CheckCircle size={16} /> Clear Done
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      )}

      {/* New Task Options Menu */}
      {activeTaskMenu && (
        <div 
            className="fixed z-[100] bg-white dark:bg-gray-800 border-2 border-black dark:border-white shadow-[6px_6px_0_0_#000] animate-in fade-in zoom-in-95 duration-150 origin-top-right w-56"
            style={{ top: activeTaskMenu.top, left: activeTaskMenu.left }}
        >
             {/* Section 1: Actions */}
             <div className="p-1.5 space-y-0.5">
                 <button 
                    onClick={() => {
                        setReschedulingTaskId(activeTaskMenu.taskId);
                        setActiveTaskMenu(null);
                    }}
                    className="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                 >
                     <Clock size={16} className="text-gray-500" />
                     <span className="text-sm font-bold uppercase">Add Deadline</span>
                 </button>
                 <button 
                    onClick={() => {
                        deleteTask(activeTaskMenu.taskId);
                        setActiveTaskMenu(null);
                    }}
                    className="w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-red-50 hover:text-red-600 transition-colors text-red-500"
                 >
                     <Trash2 size={16} />
                     <span className="text-sm font-bold uppercase">Delete</span>
                 </button>
             </div>

             {/* Unobvious Separator */}
             <div className="border-t border-gray-100 dark:border-gray-700 mx-2"></div>

             {/* Section 2: Move To List */}
             <div className="p-1.5">
                 <div className="px-3 py-1.5 text-xs font-bold text-gray-400 uppercase tracking-wider">
                     Move To...
                 </div>
                 <div className="max-h-48 overflow-y-auto custom-scrollbar">
                     {[defaultListName, 'Daily Quests', ...customLists].map((listName) => {
                         const currentTask = tasks.find(t => t.id === activeTaskMenu.taskId);
                         let isCurrent = false;
                         
                         if (currentTask) {
                             if (listName === 'Daily Quests') isCurrent = !!currentTask.isDaily;
                             else if (listName === defaultListName) isCurrent = !currentTask.isDaily && !currentTask.list;
                             else isCurrent = currentTask.list === listName;
                         }

                         return (
                             <button
                                key={listName}
                                onClick={() => handleMoveTask(activeTaskMenu.taskId, listName)}
                                className="w-full flex items-center justify-between px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"
                             >
                                 <span className={`text-sm font-bold uppercase ${isCurrent ? 'text-primary' : 'text-gray-600 dark:text-gray-300'}`}>
                                     {listName === defaultListName ? "My Quests" : listName}
                                 </span>
                                 {isCurrent && <Check size={14} className="text-primary" strokeWidth={3} />}
                             </button>
                         );
                     })}
                 </div>
             </div>
        </div>
      )}

      {/* Create/Rename List Modal */}
      <PixelModal isOpen={isListModalOpen} onClose={() => setListModalOpen(false)} title={listModalMode === 'CREATE' ? "Create New List" : "Rename List"}>
          <div className="space-y-6 pt-2">
              <PixelInput 
                  label="List Name" 
                  placeholder="e.g. Side Quests" 
                  autoFocus 
                  value={listNameInput}
                  onChange={(e) => setListNameInput(e.target.value)}
              />
              
              <div className="flex gap-4 pt-4">
                  <PixelButton variant="outline" className="flex-1" onClick={() => setListModalOpen(false)}>
                      Cancel
                  </PixelButton>
                  <PixelButton className="flex-1" onClick={handleListModalSave}>
                      Save
                  </PixelButton>
              </div>
          </div>
      </PixelModal>

      {/* Task Editor Modal */}
      <PixelModal isOpen={isEditorOpen} onClose={onCloseEditor} title="Edit Quest">
          <div className="space-y-6">
              {/* ... (Keep existing editor content same as before) ... */}
              <div className="space-y-2">
                  <label className="block text-xl font-bold uppercase">Quest Name</label>
                  <div className="relative">
                     <Edit3 className="absolute left-3 top-3 text-gray-400" size={20} />
                     <input 
                        className="w-full bg-gray-50 dark:bg-gray-800 border-3 border-black dark:border-white p-3 pl-10 text-xl outline-none focus:shadow-pixel-sm"
                        placeholder="Defeat the laundry monster"
                        value={newTaskTitle}
                        onChange={(e) => setNewTaskTitle(e.target.value)}
                        autoFocus
                     />
                  </div>
              </div>

              <div className="space-y-2">
                  <label className="block text-xl font-bold uppercase">Details</label>
                  <textarea 
                    rows={2}
                    className="w-full bg-gray-50 dark:bg-gray-800 border-3 border-black dark:border-white p-3 text-xl outline-none focus:shadow-pixel-sm resize-none"
                    placeholder="Gather all scattered socks..."
                    value={newTaskDesc}
                    onChange={(e) => setNewTaskDesc(e.target.value)}
                  />
              </div>

              <div className="space-y-2">
                  <label className="block text-xl font-bold uppercase">Add to List</label>
                  <div className="relative">
                      <select 
                        value={selectedList}
                        onChange={(e) => setSelectedList(e.target.value)}
                        className="w-full bg-white dark:bg-gray-800 border-3 border-black dark:border-white p-3 text-xl appearance-none outline-none focus:shadow-pixel-sm"
                      >
                          <option value={defaultListName}>{defaultListName}</option>
                          <option value="Daily Quests">Daily Quests</option>
                          {customLists.map(list => (
                              <option key={list} value={list}>{list}</option>
                          ))}
                      </select>
                      <ChevronDown className="absolute right-4 top-4 pointer-events-none text-gray-500" />
                  </div>
              </div>

              <div className="space-y-2">
                <label className="block text-xl font-bold uppercase">Category</label>
                <div className="grid grid-cols-4 gap-2">
                    {Object.values(TaskCategory).map(cat => (
                        <button
                            key={cat}
                            onClick={() => setNewTaskCategory(cat)}
                            className={`
                                py-3 px-2 border-2 border-black text-center text-sm font-bold uppercase transition-all flex flex-col items-center justify-center gap-1
                                ${newTaskCategory === cat ? 'bg-primary text-black shadow-sm scale-[1.02]' : 'bg-white dark:bg-gray-700 hover:bg-gray-100'}
                            `}
                        >
                            {getCategoryIcon(cat)}
                            {cat}
                        </button>
                    ))}
                </div>
              </div>
                 
              <div className="space-y-2">
                <label className="block text-xl font-bold uppercase">Priority</label>
                <div className="grid grid-cols-3 gap-2">
                    {Object.values(TaskPriority).map(p => (
                            <button
                            key={p}
                            onClick={() => setNewTaskPriority(p)}
                            className={`
                                py-3 border-2 border-black text-center text-sm font-bold uppercase transition-all flex items-center justify-center gap-2
                                ${newTaskPriority === p ? 'bg-pixel-blue text-white shadow-sm' : 'bg-white dark:bg-gray-700 hover:bg-gray-100'}
                            `}
                        >
                            {p === 'High' && <Flag size={14} className="fill-current"/>}
                            {p}
                        </button>
                    ))}
                </div>
              </div>

              <div className="space-y-2">
                   <label className="block text-xl font-bold uppercase">Timing</label>
                   <div className="flex gap-4">
                       <button 
                           onClick={() => openPicker('DUE')}
                           className="flex-1 bg-white dark:bg-gray-800 border-2 border-black dark:border-white p-2 text-sm font-bold uppercase flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
                       >
                           <span className="text-gray-500">Due</span>
                           <div className="flex items-center gap-2">
                               <span>{format(newTaskDate, 'MMM d')}</span>
                               <Calendar size={16} />
                           </div>
                       </button>

                       <button 
                           onClick={() => openPicker('REMINDER')}
                           className={`flex-1 bg-white dark:bg-gray-800 border-2 border-black dark:border-white p-2 text-sm font-bold uppercase flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${reminderDate ? 'text-primary' : ''}`}
                       >
                           <span className="text-gray-500">Remind</span>
                           <div className="flex items-center gap-2">
                               <span>{reminderDate ? format(reminderDate, 'h:mm a') : 'None'}</span>
                               <Bell size={16} />
                           </div>
                       </button>
                   </div>
              </div>

              <div className="pt-4 flex gap-4">
                  <PixelButton variant="danger" className="flex-1" onClick={onCloseEditor}>
                      Abandon
                  </PixelButton>
                  <PixelButton className="flex-[2]" onClick={handleSaveTask}>
                      Save Quest
                  </PixelButton>
              </div>
          </div>
      </PixelModal>

      {/* Reused Date Picker for both New Task & Rescheduling */}
      <PixelDatePicker 
        isOpen={isDatePickerOpen || !!reschedulingTaskId}
        onClose={() => {
            setDatePickerOpen(false);
            setReschedulingTaskId(null);
        }}
        selectedDate={reschedulingTaskId ? new Date() : (pickerMode === 'DUE' ? newTaskDate : (reminderDate || new Date()))}
        onSelectDate={(date) => {
            if (reschedulingTaskId) {
                // Handle Updating Existing Task
                const task = tasks.find(t => t.id === reschedulingTaskId);
                if (task) {
                    updateTask({ ...task, dueDate: date.toISOString() });
                }
                setReschedulingTaskId(null);
            } else {
                // Handle New Task Editor
                handleDateSelect(date);
            }
        }}
        title={reschedulingTaskId ? 'UPDATE DEADLINE' : (pickerMode === 'DUE' ? 'DUE DATE' : 'SET REMINDER')}
        includeTime={pickerMode === 'REMINDER'}
      />
    </div>
  );
};
</file>

<file path="pages/GameHub.tsx">
import React, { useState } from 'react';
import { PixelCard, PixelButton } from '../components/ui/PixelComponents';
import { Gamepad2, Grid3X3, Bomb, Trophy, Pause } from 'lucide-react';

export const GameHub: React.FC = () => {
  const [activeGame, setActiveGame] = useState<string | null>(null);
  const [isPaused, setIsPaused] = useState(false);

  const games = [
      { id: 'sudoku', name: 'Sudoku', tag: 'Logic', desc: 'Fill the grid with digits 1-9.', color: 'bg-blue-400' },
      { id: '2048', name: '2048', tag: 'Puzzle', desc: 'Slide tiles to reach 2048.', color: 'bg-yellow-400' },
      { id: 'mines', name: 'Minesweeper', tag: 'Classic', desc: 'Avoid the hidden bombs!', color: 'bg-red-400' },
  ];

  const handleQuit = () => {
      setIsPaused(false);
      setActiveGame(null);
  };

  const handleRestart = () => {
      // In a real app, this would reset the game state
      setIsPaused(false);
  };

  if (activeGame) {
      const gameInfo = games.find(g => g.id === activeGame);
      
      // Immersive Game Container
      return (
          <div className="fixed inset-0 z-50 bg-[#222] flex flex-col font-pixel text-white">
              {/* 1. Game HUD (Top Bar) */}
              <header className="h-16 border-b-2 border-white/20 bg-black flex justify-between items-center px-4 z-20 shrink-0">
                 {/* Left: Pause Button */}
                 <button 
                    onClick={() => setIsPaused(true)} 
                    className="flex items-center gap-2 hover:text-yellow-400 transition-colors group"
                 >
                     <div className="border-2 border-current p-1 rounded group-active:translate-y-0.5">
                         <Pause className="w-5 h-5" />
                     </div>
                     <span className="text-xl hidden md:inline">PAUSE</span>
                 </button>

                 {/* Center: Game Title */}
                 <div className="text-3xl font-bold tracking-widest text-yellow-400 uppercase">
                    {gameInfo?.name || 'Game'}
                 </div>

                 {/* Right: Score */}
                 <div className="flex flex-col items-end leading-none">
                     <span className="text-xs text-gray-400 uppercase">SCORE</span>
                     <span className="text-2xl font-bold">1,240</span>
                 </div>
              </header>

              {/* 2. Game Main Area */}
              <main className="flex-1 flex items-center justify-center bg-[#1a1a1a] p-4 relative z-10">
                   {/* Game Canvas Container */}
                   <div className="aspect-square w-full max-w-md max-h-[80vh] border-4 border-black shadow-[0_0_0_4px_white] rounded-lg flex items-center justify-center bg-[#f0f4f8] relative overflow-hidden">
                       
                       {/* Retro Grid Background Pattern */}
                       <div 
                           className="absolute inset-0 opacity-20 pointer-events-none" 
                           style={{ 
                               backgroundImage: 'radial-gradient(#000 2px, transparent 2px)', 
                               backgroundSize: '20px 20px',
                               backgroundPosition: '0 0'
                           }}
                       ></div>

                       {/* Mock Game Content */}
                       <div className="text-center text-black relative z-10">
                           <p className="text-2xl mb-4 opacity-50 font-bold uppercase">Game Area</p>
                           <div className="grid grid-cols-2 gap-4">
                               <div className="w-24 h-24 border-4 border-black bg-white flex items-center justify-center text-4xl font-bold shadow-[4px_4px_0_0_rgba(0,0,0,0.2)]">
                                   ?
                               </div>
                               <div className="w-24 h-24 border-4 border-black bg-yellow-400 flex items-center justify-center text-4xl font-bold shadow-[4px_4px_0_0_rgba(0,0,0,0.2)]">
                                   !
                               </div>
                           </div>
                           <p className="mt-8 text-sm font-bold animate-pulse">PRESS START</p>
                       </div>
                   </div>
              </main>

              {/* 3. Pause Menu Overlay */}
              {isPaused && (
                  <div className="fixed inset-0 z-[60] bg-black/85 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-200">
                    <div className="w-80 bg-black border-4 border-white p-6 text-center shadow-[10px_10px_0_0_rgba(255,255,255,0.2)] animate-in zoom-in-95 duration-200">
                        <h2 className="text-4xl font-bold text-yellow-400 mb-2 animate-pulse">PAUSED</h2>
                        <p className="text-gray-400 mb-8 text-lg">Don't give up now!</p>

                        <div className="space-y-4">
                            <button
                                onClick={() => setIsPaused(false)}
                                className="w-full border-2 border-white bg-white text-black py-3 text-2xl font-bold hover:bg-gray-200 transition-all active:translate-x-[2px] active:translate-y-[2px]"
                            >
                                RESUME GAME
                            </button>

                            <button
                                onClick={handleRestart}
                                className="w-full border-2 border-white bg-black text-white py-3 text-2xl font-bold hover:bg-gray-900 transition-all active:translate-x-[2px] active:translate-y-[2px]"
                            >
                                RESTART
                            </button>

                            <button
                                onClick={handleQuit}
                                className="w-full border-2 border-red-600 bg-red-600 text-white py-3 text-2xl font-bold hover:bg-red-700 mt-8 transition-all active:translate-x-[2px] active:translate-y-[2px]"
                            >
                                QUIT TO HUB
                            </button>
                        </div>
                    </div>
                  </div>
              )}
          </div>
      );
  }

  return (
    <div className="p-4 md:p-8 max-w-6xl mx-auto">
        <div className="mb-12 text-center md:text-left">
            <h1 className="text-4xl md:text-5xl font-bold mb-4 uppercase">Arcade Center</h1>
            <p className="text-xl text-gray-600 dark:text-gray-400">Take a break. Earn XP. Have fun.</p>
        </div>

        {/* Stats Row */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <StatCard label="Tasks Done" value="12/15" icon={<Grid3X3 />} color="text-green-500" />
            <StatCard label="High Score" value="24,500" icon={<Trophy />} color="text-yellow-500" />
            <StatCard label="Streak" value="5 Days" icon={<Bomb />} color="text-red-500" />
        </div>

        <h2 className="text-3xl font-bold mb-6 border-l-4 border-primary pl-4 uppercase">Available Games</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {games.map(game => (
                <div 
                    key={game.id}
                    className="group relative bg-white dark:bg-gray-800 border-4 border-black dark:border-white shadow-pixel hover:shadow-pixel-lg hover:-translate-y-2 transition-all cursor-pointer overflow-hidden"
                    onClick={() => setActiveGame(game.id)}
                >
                    <div className={`h-40 ${game.color} opacity-80 group-hover:opacity-100 transition-opacity flex items-center justify-center relative overflow-hidden`}>
                        <div className="absolute inset-0 bg-dither opacity-10"></div>
                        <Gamepad2 size={64} className="text-white drop-shadow-md transform group-hover:scale-110 transition-transform" />
                    </div>
                    <div className="p-6">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="text-2xl font-bold uppercase">{game.name}</h3>
                            <span className="bg-black text-white text-xs px-2 py-1 uppercase font-bold">{game.tag}</span>
                        </div>
                        <p className="text-gray-600 dark:text-gray-400 mb-6 text-lg">{game.desc}</p>
                        <PixelButton fullWidth className="text-sm">Play Now</PixelButton>
                    </div>
                </div>
            ))}
            
            {/* Locked Game */}
            <div className="bg-gray-100 dark:bg-gray-800 border-4 border-dashed border-gray-400 p-6 flex flex-col items-center justify-center opacity-70">
                 <div className="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4">
                     <span className="material-icons text-4xl text-gray-400">lock</span>
                 </div>
                 <h3 className="text-2xl font-bold uppercase text-gray-500">Coming Soon</h3>
            </div>
        </div>
    </div>
  );
};

const StatCard = ({ label, value, icon, color }: any) => (
    <div className="bg-card-light dark:bg-card-dark p-6 border-2 border-black dark:border-gray-600 shadow-pixel flex justify-between items-center">
        <div>
            <p className="text-gray-500 uppercase text-sm font-bold">{label}</p>
            <p className="text-3xl font-bold mt-1">{value}</p>
        </div>
        <div className={`p-3 bg-gray-100 dark:bg-gray-900 rounded border-2 border-transparent ${color}`}>
            {icon}
        </div>
    </div>
);
</file>

<file path="pages/NotFound.tsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { PixelCard, PixelButton } from '../components/ui/PixelComponents';
import { HelpCircle, Home } from 'lucide-react';

export const NotFound: React.FC = () => {
  const navigate = useNavigate();

  return (
    <div className="min-h-screen flex items-center justify-center p-4 bg-background-light dark:bg-background-dark">
      <PixelCard className="max-w-md w-full text-center space-y-6">
        <div className="flex justify-center mb-6">
          <div className="relative">
            <span className="text-8xl filter drop-shadow-sm select-none animate-bounce block">
              üê∂
            </span>
            <div className="absolute -top-4 -right-4 bg-red-100 dark:bg-red-900 border-2 border-black rounded-full p-2 animate-pulse">
                <HelpCircle size={32} className="text-red-600 dark:text-red-400" />
            </div>
          </div>
        </div>
        
        <div className="space-y-2">
          <h1 className="text-6xl font-bold text-primary mb-2">404</h1>
          <h2 className="text-2xl font-bold uppercase">Page Not Found</h2>
          <p className="text-gray-600 dark:text-gray-300 text-lg">
            Uh oh! It looks like you've wandered into unmapped territory.
          </p>
        </div>

        <div className="pt-4">
          <PixelButton 
            onClick={() => navigate('/')} 
            fullWidth 
            variant="primary"
          >
            <Home size={20} />
            Return Home
          </PixelButton>
        </div>
      </PixelCard>
    </div>
  );
};
</file>

<file path="pages/Shop.tsx">
import React, { useState } from 'react';
import { useStore } from '../store';
import { PixelCard, PixelButton } from '../components/ui/PixelComponents';
import { ShoppingBag, Check } from 'lucide-react';

export const Shop: React.FC = () => {
  const { user, shopItems, buyItem, equipItem } = useStore();
  const [showOwned, setShowOwned] = useState(false);

  const filteredItems = showOwned ? shopItems.filter(i => i.owned) : shopItems;

  return (
    <div className="p-4 md:p-8 max-w-6xl mx-auto">
        <header className="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
            <div>
                <h1 className="text-4xl md:text-5xl font-bold uppercase">Pixel Store</h1>
                <p className="text-gray-600 dark:text-gray-400">Spend your hard-earned XP!</p>
            </div>
            <div className="bg-white dark:bg-gray-800 border-2 border-black dark:border-white px-6 py-3 shadow-pixel flex items-center gap-3">
                <span className="material-icons text-primary text-3xl">monetization_on</span>
                <span className="text-3xl font-bold">{user?.xp} XP</span>
            </div>
        </header>

        {/* Filter Bar */}
        <div className="flex justify-between items-end mb-8 border-b-2 border-black pb-4">
            <div className="flex gap-4">
                <button className="text-2xl font-bold border-b-4 border-black pb-1">FRAMES</button>
                <button className="text-2xl font-bold text-gray-400 hover:text-black pb-1">THEMES</button>
            </div>
            <button 
                onClick={() => setShowOwned(!showOwned)}
                className={`flex items-center gap-2 px-4 py-2 border-2 border-black transition-all ${showOwned ? 'bg-black text-white' : 'bg-white hover:bg-gray-100'}`}
            >
                <ShoppingBag size={18} />
                <span className="uppercase font-bold">{showOwned ? 'Show All' : 'Show Owned'}</span>
            </button>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {filteredItems.map(item => (
                <PixelCard key={item.id} className="flex flex-col h-full">
                    <div className="bg-gray-100 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 h-48 mb-4 relative flex items-center justify-center">
                        {item.owned && (
                            <div className="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 border border-black font-bold uppercase">
                                Owned
                            </div>
                        )}
                        <span className="text-gray-400">Preview: {item.name}</span>
                        {/* Placeholder visual based on name */}
                        {item.name.includes('Fire') && <div className="absolute inset-0 border-4 border-red-500 opacity-50"></div>}
                        {item.name.includes('Gold') && <div className="absolute inset-0 border-4 border-yellow-500 opacity-50"></div>}
                    </div>
                    
                    <div className="mb-6 flex-1">
                        <h3 className="text-3xl font-bold uppercase mb-1">{item.name}</h3>
                        <p className="text-gray-500">{item.type} Item</p>
                    </div>

                    {item.owned ? (
                        item.equipped ? (
                            <button disabled className="w-full bg-gray-200 text-gray-500 border-2 border-gray-400 py-3 text-xl font-bold flex justify-center items-center gap-2">
                                <Check size={20} /> EQUIPPED
                            </button>
                        ) : (
                            <PixelButton variant="secondary" fullWidth onClick={() => equipItem(item.id)}>
                                EQUIP
                            </PixelButton>
                        )
                    ) : (
                        <PixelButton fullWidth onClick={() => buyItem(item.id)} disabled={user && user.xp < item.cost}>
                            BUY <span className="ml-2 bg-white/20 px-1 rounded text-sm">{item.cost} XP</span>
                        </PixelButton>
                    )}
                </PixelCard>
            ))}
        </div>
    </div>
  );
};
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
</file>

<file path="README.md">
<div align="center">
<img width="1200" height="475" alt="GHBanner" src="https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6" />
</div>

# Run and deploy your AI Studio app

This contains everything you need to run your app locally.

View your app in AI Studio: https://ai.studio/apps/drive/1YvKIzXQg77I6Fl__FRRU8mpZ9a7iY8R3

## Run Locally

**Prerequisites:**  Node.js


1. Install dependencies:
   `npm install`
2. Set the `GEMINI_API_KEY` in [.env.local](.env.local) to your Gemini API key
3. Run the app:
   `npm run dev`
</file>

<file path="store.ts">
import { create } from 'zustand';
import { Task, User, CompanionType, ShopItem, Achievement, TaskCategory, TaskPriority } from './types';

interface AppState {
  user: User | null;
  tasks: Task[];
  customLists: string[]; // Store custom list names
  shopItems: ShopItem[];
  achievements: Achievement[];
  isDarkMode: boolean;
  
  // Actions
  login: (name: string, email: string, companion: CompanionType) => void;
  logout: () => void;
  addTask: (task: Task) => void;
  addList: (name: string) => void;
  renameList: (oldName: string, newName: string) => void; // New
  deleteList: (name: string) => void; // New
  deleteCompletedTasks: (listFilter: string) => void; // New
  toggleTask: (id: string) => void;
  deleteTask: (id: string) => void;
  updateTask: (task: Task) => void;
  buyItem: (id: string) => void;
  equipItem: (id: string) => void;
  toggleDarkMode: () => void;
  addXp: (amount: number) => void;
  claimAchievement: (id: string) => void; // New Action
}

const INITIAL_TASKS: Task[] = [
  {
    id: '1',
    title: 'Walk the Dog',
    description: "Don't forget the frisbee!",
    category: TaskCategory.HEALTH,
    priority: TaskPriority.MEDIUM,
    xpReward: 150,
    completed: false,
    dueDate: new Date().toISOString(),
    isDaily: true,
  },
  {
    id: '2',
    title: 'Complete Project UI',
    description: "Finish the pixel art dashboard design.",
    category: TaskCategory.WORK,
    priority: TaskPriority.HIGH,
    xpReward: 500,
    completed: false,
    dueDate: new Date().toISOString(),
  },
  {
    id: '3',
    title: 'Water Plants',
    description: "The monstera needs some love.",
    category: TaskCategory.CHORE,
    priority: TaskPriority.LOW,
    xpReward: 100,
    completed: false,
    dueDate: new Date(Date.now() + 86400000).toISOString(),
    list: 'Backlog'
  },
];

const INITIAL_SHOP_ITEMS: ShopItem[] = [
  { id: '1', name: 'No Frame', type: 'FRAME', cost: 0, image: '', owned: true, equipped: true },
  { id: '2', name: 'Fire Aura', type: 'FRAME', cost: 450, image: '', owned: false, equipped: false },
  { id: '3', name: 'Ice Crown', type: 'FRAME', cost: 1250, image: '', owned: true, equipped: false },
  { id: '4', name: 'Golden Frame', type: 'FRAME', cost: 2000, image: '', owned: false, equipped: false },
];

const INITIAL_ACHIEVEMENTS: Achievement[] = [
  { id: '1', title: 'Novice Slayer', description: 'Complete your first 10 tasks.', status: 'CLAIMABLE', progress: 10, maxProgress: 10, reward: 200, icon: 'swords' },
  { id: '2', title: 'Early Bird', description: 'Complete a task before 8:00 AM.', status: 'COMPLETED', progress: 1, maxProgress: 1, reward: 100, icon: 'sun' },
  { id: '3', title: 'Streak Master', description: 'Maintain a 7-day login streak.', status: 'IN_PROGRESS', progress: 5, maxProgress: 7, reward: 500, icon: 'fire' },
];

export const useStore = create<AppState>((set) => ({
  user: null, // Start null to show login
  tasks: INITIAL_TASKS,
  customLists: ['Backlog', 'Shopping'], // Initial custom lists
  shopItems: INITIAL_SHOP_ITEMS,
  achievements: INITIAL_ACHIEVEMENTS,
  isDarkMode: false,

  login: (name, email, companion) => set({
    user: {
      name,
      email,
      companion,
      level: 5,
      xp: 1250,
      maxXp: 2000,
      coins: 500
    }
  }),

  logout: () => set({ user: null }),

  addTask: (task) => set((state) => ({ tasks: [...state.tasks, task] })),
  
  addList: (name) => set((state) => {
      if (state.customLists.includes(name)) return state;
      return { customLists: [...state.customLists, name] };
  }),

  renameList: (oldName, newName) => set((state) => ({
      customLists: state.customLists.map(l => l === oldName ? newName : l),
      tasks: state.tasks.map(t => t.list === oldName ? { ...t, list: newName } : t)
  })),

  deleteList: (name) => set((state) => ({
      customLists: state.customLists.filter(l => l !== name),
      tasks: state.tasks.filter(t => t.list !== name)
  })),

  deleteCompletedTasks: (listFilter) => set((state) => ({
      tasks: state.tasks.filter(t => {
          // If task is NOT completed, keep it
          if (!t.completed) return true;
          
          const defaultListName = state.user ? `${state.user.name}'s List` : "Hero's List";

          // If task IS completed, check if it belongs to the list being cleaned
          
          // Default List (Tasks that are not daily and have no list assigned)
          if (listFilter === defaultListName) {
              if (!t.isDaily && !t.list) return false;
              return true;
          }

          if (listFilter === 'DAILY' && t.isDaily) return false;
          
          // Custom Lists
          if (t.list === listFilter) return false;

          // Otherwise keep it (completed but in a different list)
          return true;
      })
  })),

  toggleTask: (id) => set((state) => {
    const task = state.tasks.find(t => t.id === id);
    const wasCompleted = task?.completed;
    
    // Add XP if completing
    if (task && !wasCompleted) {
        state.addXp(task.xpReward);
    }

    return {
      tasks: state.tasks.map((t) =>
        t.id === id ? { ...t, completed: !t.completed } : t
      ),
    };
  }),

  deleteTask: (id) => set((state) => ({
    tasks: state.tasks.filter((t) => t.id !== id)
  })),

  updateTask: (updatedTask) => set((state) => ({
    tasks: state.tasks.map((t) => t.id === updatedTask.id ? updatedTask : t)
  })),

  buyItem: (id) => set((state) => {
    const item = state.shopItems.find(i => i.id === id);
    if (!item || !state.user || state.user.xp < item.cost) return state;

    return {
        user: { ...state.user, xp: state.user.xp - item.cost },
        shopItems: state.shopItems.map(i => i.id === id ? { ...i, owned: true } : i)
    };
  }),

  equipItem: (id) => set((state) => ({
    shopItems: state.shopItems.map(i => {
        if (i.type !== 'FRAME') return i; // Only handling frames for now logic
        return i.id === id ? { ...i, equipped: true } : { ...i, equipped: false }
    })
  })),

  toggleDarkMode: () => set((state) => {
    const newMode = !state.isDarkMode;
    if (newMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
    return { isDarkMode: newMode };
  }),

  addXp: (amount) => set((state) => {
      if(!state.user) return state;
      const newXp = state.user.xp + amount;
      // Simple level up logic
      if (newXp >= state.user.maxXp) {
          return {
              user: {
                  ...state.user,
                  level: state.user.level + 1,
                  xp: newXp - state.user.maxXp,
                  maxXp: Math.floor(state.user.maxXp * 1.2)
              }
          }
      }
      return { user: { ...state.user, xp: newXp } }
  }),

  claimAchievement: (id) => set((state) => {
      const ach = state.achievements.find(a => a.id === id);
      if (!ach || ach.status !== 'CLAIMABLE' || !state.user) return state;

      // Logic to add XP (duplicated from addXp to run atomically inside this action)
      const amount = ach.reward;
      const newXp = state.user.xp + amount;
      let newUser = { ...state.user, xp: newXp };

      if (newXp >= state.user.maxXp) {
           newUser = {
               ...newUser,
               level: newUser.level + 1,
               xp: newXp - newUser.maxXp,
               maxXp: Math.floor(newUser.maxXp * 1.2)
           };
      }

      return {
          user: newUser,
          achievements: state.achievements.map(a => 
              a.id === id ? { ...a, status: 'COMPLETED' } : a
          )
      };
  })

}));
</file>

<file path="tailwind.config.js">
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
    "./*.{js,ts,jsx,tsx}",
  ],
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        primary: "#FFD028", // Retro Yellow
        secondary: "#4ADE80", // Retro Green
        accent: "#EF4444", // Retro Red
        "pixel-blue": "#3B82F6",
        "background-light": "#FFF9F0", // Cream
        "background-dark": "#1a1a1a", // Dark Grey
        "card-light": "#FFFFFF",
        "card-dark": "#2d2d2d",
      },
      fontFamily: {
        pixel: ['"VT323"', "monospace"],
      },
      boxShadow: {
        pixel: "4px 4px 0px 0px #000000",
        "pixel-sm": "2px 2px 0px 0px #000000",
        "pixel-lg": "6px 6px 0px 0px #000000",
        "pixel-active": "0px 0px 0px 0px #000000",
      },
      borderWidth: {
        3: "3px",
      },
      backgroundImage: {
        dither: "radial-gradient(#000000 1px, transparent 1px)",
        "dither-white": "radial-gradient(#ffffff 1px, transparent 1px)",
      },
      backgroundSize: {
        dither: "4px 4px",
      },
    },
  },
  plugins: [],
};
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}
</file>

<file path="types.ts">
export enum CompanionType {
  DOG = 'DOG',
  CAT = 'CAT',
}

export enum TaskCategory {
  WORK = 'Work',
  HEALTH = 'Health',
  FUN = 'Fun',
  CHORE = 'Chore',
}

export enum TaskPriority {
  HIGH = 'High',
  MEDIUM = 'Medium',
  LOW = 'Low',
}

export interface Task {
  id: string;
  title: string;
  description?: string;
  category: TaskCategory;
  priority: TaskPriority;
  xpReward: number;
  completed: boolean;
  dueDate: string; // ISO date string
  isDaily?: boolean;
  list?: string; // Optional custom list assignment
}

export interface User {
  name: string;
  email: string;
  companion: CompanionType;
  level: number;
  xp: number;
  maxXp: number;
  coins: number;
}

export interface ShopItem {
  id: string;
  name: string;
  type: 'THEME' | 'FRAME' | 'CARD';
  cost: number;
  image: string;
  owned: boolean;
  equipped: boolean;
}

export interface Achievement {
  id: string;
  title: string;
  description: string;
  status: 'LOCKED' | 'IN_PROGRESS' | 'CLAIMABLE' | 'COMPLETED';
  progress: number;
  maxProgress: number;
  reward: number;
  icon: string;
}

export interface GameSession {
  gameId: string;
  score: number;
  active: boolean;
}
</file>

<file path="vite.config.ts">
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3000,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});
</file>

</files>
